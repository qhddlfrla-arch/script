/**
 * simulator.js
 * AI ì—°ë™ ì—†ì´ ëŒ€ë³¸ ìƒì„±ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ëŠ” ëª¨ë“ˆ
 * ë‚˜ì¤‘ì— ì‹¤ì œ AI API ì—°ë™ ì‹œ ì´ íŒŒì¼ë§Œ ìˆ˜ì •í•˜ë©´ ë¨
 */

const ScriptSimulator = {
    // ì‹œë®¬ë ˆì´ì…˜ìš© ì£¼ì œ í…œí”Œë¦¿
    topicTemplates: [
        "ì´ê²ƒë§Œ ì•Œë©´ ë! {keyword} ì™„ë²½ ì •ë¦¬",
        "{keyword}ì˜ ìˆ¨ê²¨ì§„ ë¹„ë°€ TOP 5",
        "ì´ˆë³´ìžë„ ì‰½ê²Œ ë”°ë¼í•˜ëŠ” {keyword} ê°€ì´ë“œ",
        "{keyword} ë§ˆìŠ¤í„°í•˜ê¸°: ì „ë¬¸ê°€ì˜ ê¿€íŒ",
        "ì™œ ì•„ë¬´ë„ {keyword}ì— ëŒ€í•´ ë§í•˜ì§€ ì•Šì•˜ì„ê¹Œ?",
        "{keyword}ë¡œ ì¸ìƒì´ ë°”ë€ ì‚¬ëžŒë“¤ì˜ ì´ì•¼ê¸°",
        "2024ë…„ {keyword} íŠ¸ë Œë“œ ì´ì •ë¦¬",
        "{keyword} ì‹¤ì „ í™œìš©ë²• A to Z"
    ],

    // ëŒ€ë³¸ êµ¬ì¡°ë³„ ì‹œë®¬ë ˆì´ì…˜ í…œí”Œë¦¿
    scriptTemplates: {
        // 1. ì´ì•¼ê¸°ê¾¼
        storyteller: [
            "ì§„í–‰ìž A (ë°ê³  ì—ë„ˆì§€ ë„˜ì¹˜ëŠ” í†¤)",
            "ë‚˜ë ˆì´í„° (ì°¨ë¶„í•˜ê³  ì‹ ë¢°ê° ìžˆëŠ” ëª©ì†Œë¦¬)",
            "ìœ íŠœë²„ ë³¸ì¸ (ì¹œê·¼í•˜ê³  ì†”ì§í•œ ë§íˆ¬)"
        ],

        // 2. ì˜¤í”„ë‹ 5ì´ˆ - ê°•ë ¥í•œ í›„í‚¹ ë¬¸ìž¥
        hookingSentence: [
            "ì´ê±° ëª¨ë¥´ë©´ ì§„ì§œ ì†í•´ìž…ë‹ˆë‹¤.",
            "ë‹¨ 3ë¶„ë§Œ íˆ¬ìží•˜ì„¸ìš”, ì¸ìƒì´ ë°”ë€ë‹ˆë‹¤.",
            "99%ê°€ ëª¨ë¥´ëŠ” ë¹„ë°€ì„ ê³µê°œí•©ë‹ˆë‹¤.",
            "ì´ ì˜ìƒ ì•ˆ ë³´ë©´ í›„íšŒí•  ê²ë‹ˆë‹¤.",
            "ì œê°€ ì§ì ‘ ê²½í—˜í•œ ì¶©ê²©ì ì¸ ì‚¬ì‹¤ìž…ë‹ˆë‹¤."
        ],

        // 3. ì˜¤í”„ë‹ 30ì´ˆ - ë¬¸ì œ ì œê¸°
        problemStatement: [
            "í˜¹ì‹œ {keyword} ë•Œë¬¸ì— ê³ ë¯¼í•˜ê³  ê³„ì‹ ê°€ìš”? ì•„ë¬´ë¦¬ ë…¸ë ¥í•´ë„ ê²°ê³¼ê°€ ì•ˆ ë‚˜ì™€ì„œ ì¢Œì ˆí•˜ì…¨ë˜ ë¶„ë“¤ ë§Žìœ¼ì‹¤ ê²ë‹ˆë‹¤.",
            "{keyword}ì— ëŒ€í•´ ê²€ìƒ‰í•˜ë©´ ì •ë³´ëŠ” ë„˜ì³ë‚˜ëŠ”ë°, ë­ê°€ ë§žëŠ” ë§ì¸ì§€ í—·ê°ˆë¦¬ì…¨ì£ ? ì €ë„ ê·¸ëž¬ìŠµë‹ˆë‹¤.",
            "ë§¤ì¼ ì—´ì‹¬ížˆ í•˜ëŠ”ë° ì™œ {keyword}ê°€ ì•ˆ ë ê¹Œìš”? ì˜¤ëŠ˜ ê·¸ í•´ë‹µì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
        ],

        // 3. ì˜¤í”„ë‹ 30ì´ˆ - ì‹œì²­ìž íƒ€ê¹ƒ ì§€ëª©
        targetAudience: [
            "íŠ¹ížˆ {keyword}ë¥¼ ì²˜ìŒ ì‹œìž‘í•˜ì‹œëŠ” ë¶„ë“¤, ê·¸ë¦¬ê³  ì´ë¯¸ ì‹œìž‘í–ˆì§€ë§Œ ë²½ì— ë¶€ë”ªížŒ ë¶„ë“¤ê»˜ ê¼­ í•„ìš”í•œ ë‚´ìš©ìž…ë‹ˆë‹¤.",
            "ì˜¤ëŠ˜ ì˜ìƒì€ {keyword}ì— ì§„ì‹¬ì¸ ë¶„ë“¤ì„ ìœ„í•´ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤.",
            "{keyword}ë¡œ ì§„ì§œ ì„±ê³¼ë¥¼ ë‚´ê³  ì‹¶ì€ ë¶„ë“¤ë§Œ ë³´ì„¸ìš”."
        ],

        // 3. ì˜¤í”„ë‹ 30ì´ˆ - ì½˜í…ì¸  ì˜ˆê³ 
        contentPreview: [
            "ì˜¤ëŠ˜ ì˜ìƒì—ì„œëŠ” ì œê°€ ì§ì ‘ í…ŒìŠ¤íŠ¸í•˜ê³  ê²€ì¦í•œ {keyword}ì˜ í•µì‹¬ í¬ì¸íŠ¸ 2ê°€ì§€ë¥¼ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
            "ì´ë²ˆ ì˜ìƒì—ì„œ ë‹¤ë£° ë‚´ìš©ì€ {keyword}ì˜ ê¸°ì´ˆë¶€í„° ì‹¤ì „ í™œìš©ë²•ê¹Œì§€ ëª¨ë“  ê²ƒìž…ë‹ˆë‹¤.",
            "ì˜¤ëŠ˜ì€ {keyword}ì— ëŒ€í•œ ì˜¤í•´ì™€ ì§„ì‹¤, ê·¸ë¦¬ê³  ë°”ë¡œ ì ìš© ê°€ëŠ¥í•œ íŒì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤."
        ],

        // ë¸Œë¦¿ì§€ ë¬¸ìž¥
        bridge: [
            "ìž, ê·¸ëŸ¼ ë³¸ê²©ì ìœ¼ë¡œ ì‹œìž‘í•´ë³¼ê¹Œìš”?",
            "ë°”ë¡œ í•µì‹¬ ë‚´ìš©ìœ¼ë¡œ ë“¤ì–´ê°€ê² ìŠµë‹ˆë‹¤.",
            "ê·¸ëŸ¼ í•˜ë‚˜ì”© ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.",
            "ì¤€ë¹„ë˜ì…¨ë‚˜ìš”? ì‹œìž‘í•©ë‹ˆë‹¤!",
            "ì§€ê¸ˆë¶€í„° ì§‘ì¤‘í•´ì£¼ì„¸ìš”."
        ],

        // 4. í•˜ìœ„ ì£¼ì œ 1
        subTopic1: [
            "ê¸°ë³¸ ê°œë… ì´í•´í•˜ê¸°",
            "ì™œ ì´ê²Œ ì¤‘ìš”í•œê°€?",
            "í”ížˆ í•˜ëŠ” ì‹¤ìˆ˜ 3ê°€ì§€",
            "ì‹œìž‘ ì „ ë°˜ë“œì‹œ ì•Œì•„ì•¼ í•  ê²ƒ"
        ],

        // 5. ì£¼ì œ 1 ë‚´ìš©
        topic1Content: [
            "ì²« ë²ˆì§¸ë¡œ ì•Œì•„ì•¼ í•  ê²ƒì€ ë°”ë¡œ ê¸°ë³¸ê¸°ìž…ë‹ˆë‹¤. ë§Žì€ ë¶„ë“¤ì´ ì´ ë¶€ë¶„ì„ ê±´ë„ˆë›°ëŠ”ë°ìš”, ì‚¬ì‹¤ ì´ê²Œ ê°€ìž¥ ì¤‘ìš”í•©ë‹ˆë‹¤. ê¸°ë³¸ì´ íƒ„íƒ„í•´ì•¼ ì‘ìš©ë„ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì´ì£ .\n\nêµ¬ì²´ì ìœ¼ë¡œ ë§ì”€ë“œë¦¬ë©´, {keyword}ì˜ í•µì‹¬ì€ 'ê¾¸ì¤€í•¨'ê³¼ 'ë°©í–¥ì„±' ë‘ ê°€ì§€ìž…ë‹ˆë‹¤. ì•„ë¬´ë¦¬ ì—´ì‹¬ížˆ í•´ë„ ë°©í–¥ì´ í‹€ë¦¬ë©´ ì˜ë¯¸ê°€ ì—†ê³ , ë°©í–¥ì´ ë§žì•„ë„ ê¾¸ì¤€ížˆ í•˜ì§€ ì•Šìœ¼ë©´ ê²°ê³¼ê°€ ì•ˆ ë‚˜ì˜µë‹ˆë‹¤.",
            "ê°€ìž¥ ë¨¼ì € ì´í•´í•´ì•¼ í•  ê²ƒì€ {keyword}ì˜ ë³¸ì§ˆìž…ë‹ˆë‹¤. ë§Žì€ ë¶„ë“¤ì´ í‘œë©´ì ì¸ ê²ƒì—ë§Œ ì§‘ì¤‘í•˜ì‹œëŠ”ë°ìš”, ì§„ì§œ ì¤‘ìš”í•œ ê±´ ê·¸ ì•ˆì— ìˆ¨ê²¨ì§„ ì›ë¦¬ìž…ë‹ˆë‹¤.\n\nì œê°€ ìˆ˜ë…„ê°„ ê²½í—˜í•˜ë©´ì„œ ê¹¨ë‹¬ì€ ê²ƒì€, {keyword}ëŠ” ë‹¨ìˆœí•œ ê¸°ìˆ ì´ ì•„ë‹ˆë¼ 'ë§ˆì¸ë“œì…‹'ì´ë¼ëŠ” ê²ë‹ˆë‹¤. ì´ ê´€ì ì„ ë°”ê¾¸ëŠ” ìˆœê°„, ê²°ê³¼ë„ ë‹¬ë¼ì§‘ë‹ˆë‹¤."
        ],

        // 7. ì£¼ì œ 2 ë‚´ìš©
        topic2Content: [
            "ë‘ ë²ˆì§¸ í•µì‹¬ í¬ì¸íŠ¸ëŠ” ë°”ë¡œ 'ì‹¤í–‰'ìž…ë‹ˆë‹¤. ì•Œê³  ìžˆëŠ” ê²ƒê³¼ í•˜ëŠ” ê²ƒì€ ì™„ì „ížˆ ë‹¤ë¦…ë‹ˆë‹¤.\n\në§Žì€ ë¶„ë“¤ì´ ê³µë¶€ë§Œ í•˜ê³  ì‹¤í–‰ì€ ì•ˆ í•˜ì‹œëŠ”ë°ìš”, {keyword}ëŠ” íŠ¹ížˆ ì§ì ‘ í•´ë´ì•¼ ëŠëŠ” ì˜ì—­ìž…ë‹ˆë‹¤.\n\nì œê°€ ì¶”ì²œë“œë¦¬ëŠ” ë°©ë²•ì€ 'ìž‘ê²Œ ì‹œìž‘í•˜ê¸°'ìž…ë‹ˆë‹¤. ì²˜ìŒë¶€í„° ì™„ë²½í•˜ê²Œ í•˜ë ¤ê³  í•˜ì§€ ë§ˆì‹œê³ , ì¼ë‹¨ ì‹œìž‘í•˜ì„¸ìš”. ê·¸ë¦¬ê³  í”¼ë“œë°±ì„ ë°›ìœ¼ë©° ê°œì„ í•˜ì„¸ìš”.",
            "ì´ì œ ë‘ ë²ˆì§¸ë¡œ ì¤‘ìš”í•œ ì´ì•¼ê¸°ë¥¼ í•´ë“œë¦´ê²Œìš”. ë°”ë¡œ {keyword}ë¥¼ ì§€ì†í•˜ëŠ” ë°©ë²•ìž…ë‹ˆë‹¤.\n\nì‹œìž‘ì€ ëˆ„êµ¬ë‚˜ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ 3ê°œì›”, 6ê°œì›”, 1ë…„... ì´ë ‡ê²Œ ì˜¤ëž˜ í•˜ëŠ” ì‚¬ëžŒì€ ë“œë¬¼ì£ .\n\nê·¸ ë¹„ê²°ì€ 'ì‹œìŠ¤í…œí™”'ì— ìžˆìŠµë‹ˆë‹¤. ì˜ì§€ì— ì˜ì¡´í•˜ì§€ ë§ê³ , ë£¨í‹´ì„ ë§Œë“œì„¸ìš”. ìžë™ìœ¼ë¡œ í•˜ê²Œ ë˜ë©´ í¬ê¸°í•  í™•ë¥ ì´ í˜„ì €ížˆ ì¤„ì–´ë“­ë‹ˆë‹¤."
        ],

        // 9. í´ë¡œì§• - ì•”ì‹œ (ìš”ì•½ & í™œìš© ê°•ì¡°)
        closingSummary: [
            "ì˜¤ëŠ˜ ë§ì”€ë“œë¦° ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦¬ë©´, ì²«ì§¸ ê¸°ë³¸ê¸°ê°€ ê°€ìž¥ ì¤‘ìš”í•˜ê³ , ë‘˜ì§¸ ìž‘ê²Œë¼ë„ ë°”ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ í•µì‹¬ìž…ë‹ˆë‹¤. ì´ ë‘ ê°€ì§€ë§Œ ê¸°ì–µí•˜ì…”ë„ {keyword}ì—ì„œ í™•ì‹¤ížˆ ì„±ìž¥í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.",
            "ì •ë¦¬í•˜ë©´, {keyword}ì˜ í•µì‹¬ì€ 'ì›ë¦¬ ì´í•´'ì™€ 'ê¾¸ì¤€í•œ ì‹¤í–‰'ìž…ë‹ˆë‹¤. ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì„ ë°”ë¡œ ì ìš©í•´ë³´ì„¸ìš”. ë¶„ëª… ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ì–»ìœ¼ì‹¤ ê²ë‹ˆë‹¤."
        ],

        // 9. í´ë¡œì§• - ë…ë ¤ (ê³µê° ìœ ë„)
        closingEncouragement: [
            "ì—¬ëŸ¬ë¶„ë„ ì¶©ë¶„ížˆ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì €ë„ ì²˜ìŒì—” ì•„ë¬´ê²ƒë„ ëª°ëžê±°ë“ ìš”. ì§€ê¸ˆ ì´ ì˜ìƒì„ ë³´ê³  ê³„ì‹  ê²ƒë§Œìœ¼ë¡œë„ ì´ë¯¸ í•œ ë°œ ì•žì„œ ìžˆëŠ” ê²ë‹ˆë‹¤.",
            "í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”. {keyword}ëŠ” ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì¼ìž…ë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ë§Œí¼ ê°€ì¹˜ ìžˆëŠ” ì¼ì´ê¸°ë„ í•©ë‹ˆë‹¤."
        ],

        // 9. í´ë¡œì§• - êµ¬ë…/ì¢‹ì•„ìš” ìœ ë„
        ctaSubscribe: [
            "ì´ ì˜ìƒì´ ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ ðŸ‘ ì¢‹ì•„ìš”ì™€ ðŸ”” êµ¬ë… ë¶€íƒë“œë¦½ë‹ˆë‹¤! ì•Œë¦¼ ì„¤ì •ê¹Œì§€ í•´ë‘ì‹œë©´ ìƒˆ ì˜ìƒì„ ë†“ì¹˜ì§€ ì•Šìœ¼ì‹¤ ìˆ˜ ìžˆì–´ìš”.",
            "ì¢‹ì•„ìš”ì™€ êµ¬ë…ì€ í° íž˜ì´ ë©ë‹ˆë‹¤! ðŸ™ ë” ì¢‹ì€ ì½˜í…ì¸ ë¡œ ë³´ë‹µí• ê²Œìš”.",
            "êµ¬ë…ê³¼ ì¢‹ì•„ìš”, ì•Œë¦¼ ì„¤ì •! ìžŠì§€ ë§ˆì„¸ìš”! ðŸ’œ ë‹¤ìŒ ì˜ìƒì—ì„œ ë˜ ë§Œë‚˜ìš”!"
        ]
    },

    /**
     * ìž…ë ¥ í…ìŠ¤íŠ¸ì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ (ì‹œë®¬ë ˆì´ì…˜)
     */
    extractKeyword(text) {
        const words = text.split(/\s+/).filter(word => word.length > 2);
        const commonWords = ['ì•ˆë…•í•˜ì„¸ìš”', 'ì—¬ëŸ¬ë¶„', 'ì˜¤ëŠ˜', 'ì˜ìƒ', 'êµ¬ë…', 'ì¢‹ì•„ìš”', 'ê°ì‚¬', 'ì´ë²ˆ', 'ëŒ€í•´', 'ëŒ€í•´ì„œ', 'ë³´ê² ìŠµë‹ˆë‹¤', 'ë“œë¦¬ê² ìŠµë‹ˆë‹¤'];
        const filtered = words.filter(word => !commonWords.includes(word));

        if (filtered.length > 0) {
            const randomIndex = Math.floor(Math.random() * Math.min(5, filtered.length));
            return filtered[randomIndex] || 'ìœ íŠœë¸Œ ì„±ìž¥';
        }
        return 'ì½˜í…ì¸  ì œìž‘';
    },

    /**
     * ëžœë¤ ìš”ì†Œ ì„ íƒ
     */
    getRandomElement(array) {
        return array[Math.floor(Math.random() * array.length)];
    },

    /**
     * í…œí”Œë¦¿ì— í‚¤ì›Œë“œ ì ìš©
     */
    applyKeyword(template, keyword) {
        return template.replace(/\{keyword\}/g, keyword);
    },

    /**
     * ìƒˆë¡œìš´ ì£¼ì œ ìƒì„±
     */
    generateTopic(originalScript) {
        const keyword = this.extractKeyword(originalScript);
        const template = this.getRandomElement(this.topicTemplates);
        return template.replace('{keyword}', keyword);
    },

    /**
     * êµ¬ì¡°í™”ëœ ëŒ€ë³¸ ìƒì„±
     */
    generateScript(topic, originalScript) {
        const keyword = this.extractKeyword(originalScript);
        const t = this.scriptTemplates;

        // ê° ì„¹ì…˜ ëžœë¤ ì„ íƒ ë° í‚¤ì›Œë“œ ì ìš©
        const storyteller = this.getRandomElement(t.storyteller);
        const hooking = this.getRandomElement(t.hookingSentence);
        const problem = this.applyKeyword(this.getRandomElement(t.problemStatement), keyword);
        const target = this.applyKeyword(this.getRandomElement(t.targetAudience), keyword);
        const preview = this.applyKeyword(this.getRandomElement(t.contentPreview), keyword);
        const bridge1 = this.getRandomElement(t.bridge);
        const subTopic1 = this.getRandomElement(t.subTopic1);
        const topic1 = this.applyKeyword(this.getRandomElement(t.topic1Content), keyword);
        const bridge2 = this.getRandomElement(t.bridge);
        const topic2 = this.applyKeyword(this.getRandomElement(t.topic2Content), keyword);
        const bridge3 = this.getRandomElement(t.bridge);
        const summary = this.applyKeyword(this.getRandomElement(t.closingSummary), keyword);
        const encourage = this.applyKeyword(this.getRandomElement(t.closingEncouragement), keyword);
        const ctaSubscribe = this.getRandomElement(t.ctaSubscribe);

        // êµ¬ì¡°í™”ëœ ëŒ€ë³¸ ìƒì„±
        const script = `1. ì´ì•¼ê¸°ê¾¼: ${storyteller}

2. ì˜¤í”„ë‹ 5ì´ˆ:
   - ê°•ë ¥í•œ í›„í‚¹ ë¬¸ìž¥: ${hooking}

3. ì˜¤í”„ë‹ 30ì´ˆ:
   - ë¬¸ì œ ì œê¸° â†’ ê¸°ëŒ€ê° ìœ ë„: ${problem}
   - ì‹œì²­ìž íƒ€ê¹ƒ ì§ì ‘ ì§€ëª©: ${target}
   - ì½˜í…ì¸  ì˜ˆê³ : ${preview}
   - ë¸Œë¦¿ì§€ ë¬¸ìž¥: ${bridge1}

4. í•˜ìœ„ ì£¼ì œ 1: ${subTopic1}

5. ì£¼ì œ 1: ${topic1}

6. ë¸Œë¦¿ì§€ ë¬¸ìž¥: ${bridge2}

7. ì£¼ì œ 2: ${topic2}

8. ë¸Œë¦¿ì§€ ë¬¸ìž¥: ${bridge3}

9. í´ë¡œì§•:
   - ì•”ì‹œ (ìš”ì•½ & í™œìš© ê°•ì¡°): ${summary}
   - ë…ë ¤ (ê³µê° ìœ ë„): ${encourage}
   - êµ¬ë…ê³¼ ì¢‹ì•„ìš”ë¥¼ ìœ ë„í•˜ì˜€ëŠ”ê°€? âœ… ${ctaSubscribe}`;

        return script;
    },

    /**
     * ëŒ€ë³¸ ìƒì„± ì‹œë®¬ë ˆì´ì…˜ (ë©”ì¸ í•¨ìˆ˜)
     */
    async generate(originalScript) {
        const delay = 1500 + Math.random() * 1500;

        return new Promise((resolve) => {
            setTimeout(() => {
                const topic = this.generateTopic(originalScript);
                const script = this.generateScript(topic, originalScript);

                resolve({
                    topic,
                    script
                });
            }, delay);
        });
    }
};
